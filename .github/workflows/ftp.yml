name: Build and Deploy

on: push

env:
  PYTHON_VERSION: 3.11

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Build Start Notif
        run: |
          curl "https://mc.bloom.host/api/client/servers/e2d8cd97/command" \
            -H 'Accept: application/json' \
            -H 'Content-Type: application/json' \
            -H 'Authorization: Bearer ${{ secrets.BLOOM_API_KEY }}' \
            -X POST \
            -d '{
              "command": "say pushing latest code to server..."
            }'

      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: ${{ env.PYTHON_VERSION }}

      - name: Install dependencies
        run: pip install requests

      - name: Send message to server
        env:
          BLOOM_API_KEY: "${{ secrets.BLOOM_API_KEY }}"
        run: poetry run python .github/workflows/send_bloom.py
